# PRD â€“ Plataforma Pegasus
> SaaS de torneios corporativos multi-modalidade e engajamento esportivo interno  

<overview>

### ğŸ§© Problema  
Empresas organizam eventos esportivos internos de forma manual (planilhas, WhatsApp, formulÃ¡rios), gerando baixa adesÃ£o, falta de histÃ³rico e dificuldade de mensurar engajamento.  

### ğŸ‘¥ UsuÃ¡rios-alvo  
1. **RH / Endomarketing:** promove torneios e campanhas internas.  
2. **Colaboradores:** participam, criam equipes e acompanham resultados.  
3. **AgÃªncias externas:** gerenciam mÃºltiplas empresas via white-label.  

### ğŸ¯ MÃ©tricas de sucesso  
- CriaÃ§Ã£o de torneio em **< 10 min**.  
- AdesÃ£o â‰¥ 80 % entre convidados.  
- RetenÃ§Ã£o mensal â‰¥ 70 %.  
- Tempo mÃ©dio de resposta da API < 200 ms.  

</overview>

---

<functional-decomposition>

## Capability: Tenant & AutenticaÃ§Ã£o
- **DescriÃ§Ã£o:** controlar acesso e identidade visual por empresa.  
- **Features:**
  - **Login corporativo (SSO)** â€” Auth.js com Google/Microsoft.  
  - **Branding dinÃ¢mico** â€” logo, cores, domÃ­nio e tema por tenant.  
  - **GestÃ£o de usuÃ¡rios** â€” convites, papÃ©is (admin, atleta, organizador).

## Capability: Eventos & Modalidades
- **DescriÃ§Ã£o:** permitir criaÃ§Ã£o e acompanhamento de torneios e amistosos.  
- **Features:**
  - **CRUD de torneios e modalidades** â€” Futebol, VÃ´lei, Beach Tennis, etc.  
  - **GeraÃ§Ã£o automÃ¡tica de chaves** â€” simples, dupla, grupos, pontos corridos.  
  - **Agendamento de partidas** â€” calendÃ¡rio e reservas de horÃ¡rio/arena.  

## Capability: GamificaÃ§Ã£o & Campanhas
- **DescriÃ§Ã£o:** aumentar engajamento por meio de ranking e conquistas.  
- **Features:**
  - **Sistema de pontuaÃ§Ã£o e ranking** â€” individual e por equipe.  
  - **Badges e conquistas** â€” performance, participaÃ§Ã£o, fair play.  
  - **Campanhas temÃ¡ticas** â€” ex.: Outubro Rosa, Copa Interna.  

## Capability: Compartilhamento & Engajamento
- **DescriÃ§Ã£o:** divulgar resultados e interaÃ§Ãµes internas.  
- **Features:**
  - **PÃ¡gina pÃºblica de resultados** â€” link externo da empresa.  
  - **Feed interno multimÃ­dia** â€” fotos, vÃ­deos, comentÃ¡rios.  
  - **NotificaÃ§Ãµes push e e-mail** â€” via OneSignal / Resend.  

## Capability: AdministraÃ§Ã£o & Billing
- **DescriÃ§Ã£o:** gestÃ£o multi-empresa e cobranÃ§a automÃ¡tica.  
- **Features:**
  - **Painel multi-tenant** â€” mÃ©tricas e relatÃ³rios por organizaÃ§Ã£o.  
  - **IntegraÃ§Ã£o de billing** â€” Stripe / LemonSqueezy (planos mensais).  
  - **Monitoramento e logs** â€” Sentry + Loki + Grafana.  

</functional-decomposition>

---

<structural-decomposition>

```
project-root/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/                 # Config, logger, env, Prisma
â”‚   â”œâ”€â”€ auth/                 # SSO + tenant management
â”‚   â”œâ”€â”€ events/               # CRUD torneios e modalidades
â”‚   â”œâ”€â”€ matches/              # GeraÃ§Ã£o de chaves e agenda
â”‚   â”œâ”€â”€ gamification/         # Ranking, badges, campanhas
â”‚   â”œâ”€â”€ sharing/              # Feed e pÃ¡ginas pÃºblicas
â”‚   â”œâ”€â”€ billing/              # Stripe/LemonSqueezy integraÃ§Ã£o
â”‚   â”œâ”€â”€ ui/                   # Tailwind + Shadcn components
â”‚   â””â”€â”€ hooks/                # Zustand stores + TanStack Query
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma
â”‚   â””â”€â”€ seed.ts
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ e2e/
â””â”€â”€ docs/
```

**Exports pÃºblicos principais**
- `useAuthStore`, `useEventStore`, `useRankingStore` (Zustand)  
- `api/` rotas REST / GraphQL (Next API Routes)  
- `components/` (Shadcn UI personalizados)  

</structural-decomposition>

---

<dependency-graph>

### ğŸ§± Foundation (Phase 0)
Sem dependÃªncias diretas.  
- **core** â†’ logging, configuraÃ§Ã£o, conexÃ£o Prisma.  
- **ui** â†’ base visual (Tailwind v4 + Shadcn UI).  

### ğŸ” Layer 1 â€“ AutenticaÃ§Ã£o
- **auth** â†’ depende de [core, ui].  

### ğŸ† Layer 2 â€“ Eventos & Partidas
- **events** â†’ depende de [core, auth].  
- **matches** â†’ depende de [events, core].  

### ğŸ® Layer 3 â€“ GamificaÃ§Ã£o
- **gamification** â†’ depende de [matches, events].  

### ğŸŒ Layer 4 â€“ Compartilhamento & Billing
- **sharing** â†’ depende de [gamification, events].  
- **billing** â†’ depende de [core, auth].  

</dependency-graph>

---

<implementation-roadmap>

### Phase 0 â€“ Foundation
**Goal:** estabelecer base tÃ©cnica e design system.  
**Entry Criteria:** repositÃ³rio limpo.  
**Tasks:**
- [ ] Implementar `core` (config, logger, env) â€” *sem dependÃªncias*.  
- [ ] Configurar Prisma + PostgreSQL.  
- [ ] Setup Tailwind v4 + Shadcn UI (theme tokens, layout base).  
**Exit Criteria:** app renderiza layout base e conecta DB.  

### Phase 1 â€“ Auth & Tenant
**Goal:** autenticaÃ§Ã£o multi-empresa funcional.  
**Tasks:**
- [ ] Implementar Auth.js (Google/Microsoft).  
- [ ] Criar modelos `Tenant`, `User`, `Role`.  
- [ ] Adicionar `useAuthStore` (Zustand + persist sessionStorage).  
**Exit Criteria:** login/logout funcionando; tenant isolado.  

### Phase 2 â€“ Eventos & Partidas
**Goal:** permitir criaÃ§Ã£o de torneios e agendamentos.  
**Tasks:**
- [ ] CRUD Eventos (Next API Routes + TanStack Query).  
- [ ] GeraÃ§Ã£o automÃ¡tica de chaves (BullMQ worker).  
- [ ] CalendÃ¡rio de partidas (DayPicker + React Query).  
**Exit Criteria:** torneio criado e partidas visÃ­veis na UI.  

### Phase 3 â€“ GamificaÃ§Ã£o
**Goal:** ranking e conquistas automÃ¡ticas.  
**Tasks:**
- [ ] Sistema de pontuaÃ§Ã£o & ranking global.  
- [ ] Tabela de conquistas e badges.  
- [ ] Store `useRankingStore`.  
**Exit Criteria:** ranking visÃ­vel e atualizado por evento.  

### Phase 4 â€“ Compartilhamento & Billing
**Goal:** engajamento e monetizaÃ§Ã£o.  
**Tasks:**
- [ ] PÃ¡gina pÃºblica de resultados (SEO + OpenGraph).  
- [ ] Feed interno com upload S3 / Cloudflare Images.  
- [ ] IntegraÃ§Ã£o Stripe / LemonSqueezy + trial 7 dias.  
- [ ] Observabilidade (Sentry + Loki + Grafana).  
**Exit Criteria:** billing funcional, logs operando, link pÃºblico ativo.  

</implementation-roadmap>

---

<test-strategy>

### PirÃ¢mide de testes
```
        /\
       /E2E\        â† 10 %
      /------\
     /Integration\  â† 20 %
    /------------\
   /  Unit Tests  \â† 70 %
  /----------------\
```
**Cobertura mÃ­nima:** 80 % linhas / 70 % branches.  
**Frameworks:** Vitest + Testing Library + Playwright.  

### Casos crÃ­ticos
- Login SSO multi-tenant.  
- GeraÃ§Ã£o de chave de torneio.  
- CÃ¡lculo de ranking.  
- Fluxo de cobranÃ§a e trial.  

</test-strategy>

---

<architecture>

### Componentes principais
- **Frontend Next.js 15 + React 19** â€” SSR, app router, caching estÃ¡tico.  
- **Backend** â€” Next API Routes (Node 18+) + Prisma ORM.  
- **Auth** â€” NextAuth + JWT assinado, suporte SSO.  
- **DB** â€” PostgreSQL (tenantId por tabela).  
- **State** â€” Zustand + TanStack Query (persistÃªncia e cache).  
- **Design System** â€” Tailwind v4 + Shadcn UI tokens.  
- **Infra** â€” Vercel (front) + AWS ECS/RDS (back) + Redis (BullMQ).  
- **Billing** â€” Stripe / LemonSqueezy.  
- **Monitoring** â€” Sentry + Loki + Grafana.  
- **Storage** â€” AWS S3 ou Cloudflare R2.  

**Decision examples**
- **Next API Routes**  
  - âœ… Simplifica monorepo. âš ï¸ Limite de execuÃ§Ã£o em Vercel > usar ECS p/ jobs.  
- **Prisma ORM**  
  - âœ… Produtividade alta. âš ï¸ Cuidado com migrations multi-tenant.  
- **Zustand + TanStack Query**  
  - âœ… Performance excelente e controle explÃ­cito. âš ï¸ Manter sincronizaÃ§Ã£o clara.  

</architecture>

---

<risks>

### TÃ©cnicos
- **Complexidade multi-tenant** â€” alta; mitigar com testes isolados por tenant.  
- **GeraÃ§Ã£o de chaves esportivas** â€” algoritmos variados; usar estrutura plugÃ¡vel.  
- **Limites de execuÃ§Ã£o Vercel** â€” mover jobs para ECS.  

### DependÃªncias
- Stripe/LemonSqueezy APIs; fallback = modo manual de pagamento.  
- AutenticaÃ§Ã£o Google/Microsoft (SSO).  

### Escopo
- Evitar suporte a demasiadas modalidades no MVP â†’ iniciar com futebol e vÃ´lei.  

</risks>

---

<appendix>
**ReferÃªncias**  
- Microsoft RPG Methodology (Task-Master parser).  
- Next.js 15 docs.  
- Zustand + TanStack Query patterns.  
- Nielsen Heuristics (UX).  
- Arquivos locais *.mdc (architecture, performance, security, seo, validations).  

**GlossÃ¡rio**  
- *Tenant:* empresa ou organizaÃ§Ã£o com branding prÃ³prio.  
- *Match:* partida agendada entre equipes.  
- *Campaign:* evento especial com pontuaÃ§Ã£o extra.  

</appendix>

---

<task-master-integration>
1. Cada `Capability` vira uma *task principal*.  
2. Cada `Feature` gera subtasks.  
3. As dependÃªncias definem ordem topolÃ³gica (foundation â†’ layers).  
4. Fases alimentam o cronograma do orquestrador.  
5. As seÃ§Ãµes `test-strategy` e `architecture` guiam geraÃ§Ã£o de testes e setup do Cursor.  
</task-master-integration>
