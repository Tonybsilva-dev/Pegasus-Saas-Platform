<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pegasus – Dependency Graph (Interactive)</title>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        background: #0f172a;
        color: #e2e8f0;
        font-family:
          ui-sans-serif,
          system-ui,
          -apple-system;
      }
      .wrap {
        height: 100%;
        display: grid;
        grid-template-rows: auto 1fr;
      }
      header {
        padding: 12px 16px;
        border-bottom: 1px solid #1e293b;
        display: flex;
        gap: 12px;
        align-items: center;
      }
      header h1 {
        font-size: 16px;
        margin: 0;
      }
      .controls button {
        background: #1e293b;
        border: 1px solid #334155;
        color: #e2e8f0;
        padding: 6px 10px;
        border-radius: 8px;
        cursor: pointer;
      }
      .controls button:hover {
        background: #0b1220;
      }
      .stage {
        position: relative;
        overflow: hidden;
      }
      .stage svg {
        width: 100%;
        height: 100%;
      }
      .tooltip {
        position: absolute;
        pointer-events: none;
        background: rgba(15, 23, 42, 0.9);
        color: #e2e8f0;
        border: 1px solid #334155;
        padding: 6px 8px;
        border-radius: 6px;
        font-size: 12px;
        white-space: pre;
        transform: translate(-50%, -120%);
        opacity: 0;
        transition: opacity 0.12s ease;
      }
      .hint {
        margin-left: auto;
        font-size: 12px;
        opacity: 0.8;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <h1>Pegasus – Dependency Graph</h1>
        <div class="controls">
          <button id="reset">Reset</button>
          <button id="zoomIn">Zoom +</button>
          <button id="zoomOut">Zoom −</button>
        </div>
        <div class="hint">
          Dica: arraste para mover · use a roda do mouse para zoom
        </div>
      </header>
      <div class="stage" id="stage">
        <?xml version="1.0" encoding="UTF-8" standalone="no"?>
        <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
        <!-- Generated by graphviz version 2.43.0 (0)
 -->
        <!-- Title: PegasusDependencies Pages: 1 -->
        <svg
          width="720pt"
          height="84pt"
          viewBox="0.00 0.00 720.00 83.98"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
        >
          <g
            id="graph0"
            class="graph"
            transform="scale(0.62 0.62) rotate(0) translate(4 130.95)"
          >
            <title>PegasusDependencies</title>
            <polygon
              fill="white"
              stroke="transparent"
              points="-4,4 -4,-130.95 1153,-130.95 1153,4 -4,4"
            />
            <!-- core -->
            <g id="node1" class="node">
              <title>core</title>
              <polygon
                fill="#f6d365"
                stroke="black"
                points="175,-55.95 0,-55.95 0,-17.95 175,-17.95 175,-55.95"
              />
              <text
                text-anchor="middle"
                x="87.5"
                y="-40.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                core
              </text>
              <text
                text-anchor="middle"
                x="87.5"
                y="-25.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                Config, logger, Prisma
              </text>
            </g>
            <!-- auth -->
            <g id="node3" class="node">
              <title>auth</title>
              <polygon
                fill="#fda085"
                stroke="black"
                points="348,-126.95 211,-126.95 211,-88.95 348,-88.95 348,-126.95"
              />
              <text
                text-anchor="middle"
                x="279.5"
                y="-111.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                auth
              </text>
              <text
                text-anchor="middle"
                x="279.5"
                y="-96.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                Auth.js + Tenant
              </text>
            </g>
            <!-- core&#45;&gt;auth -->
            <g id="edge1" class="edge">
              <title>core&#45;&gt;auth</title>
              <path
                fill="none"
                stroke="black"
                d="M139.42,-55.98C163.59,-65.01 192.65,-75.87 217.95,-85.32"
              />
              <polygon
                fill="black"
                stroke="black"
                points="216.85,-88.65 227.44,-88.87 219.3,-82.09 216.85,-88.65"
              />
            </g>
            <!-- events -->
            <g id="node4" class="node">
              <title>events</title>
              <polygon
                fill="#fbc2eb"
                stroke="black"
                points="537,-106.95 413,-106.95 413,-68.95 537,-68.95 537,-106.95"
              />
              <text
                text-anchor="middle"
                x="475"
                y="-91.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                events
              </text>
              <text
                text-anchor="middle"
                x="475"
                y="-76.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                CRUD torneios
              </text>
            </g>
            <!-- core&#45;&gt;events -->
            <g id="edge3" class="edge">
              <title>core&#45;&gt;events</title>
              <path
                fill="none"
                stroke="black"
                d="M175.01,-48.39C243.71,-57.48 338.58,-70.03 402.9,-78.54"
              />
              <polygon
                fill="black"
                stroke="black"
                points="402.57,-82.03 412.95,-79.87 403.49,-75.09 402.57,-82.03"
              />
            </g>
            <!-- matches -->
            <g id="node5" class="node">
              <title>matches</title>
              <polygon
                fill="#fbc2eb"
                stroke="black"
                points="745,-40.95 602,-40.95 602,-2.95 745,-2.95 745,-40.95"
              />
              <text
                text-anchor="middle"
                x="673.5"
                y="-25.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                matches
              </text>
              <text
                text-anchor="middle"
                x="673.5"
                y="-10.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                Chaves &amp; Agenda
              </text>
            </g>
            <!-- core&#45;&gt;matches -->
            <g id="edge6" class="edge">
              <title>core&#45;&gt;matches</title>
              <path
                fill="none"
                stroke="black"
                d="M175.26,-23C270.98,-9.46 429.58,7.5 566,-3.95 574.39,-4.65 583.12,-5.66 591.81,-6.85"
              />
              <polygon
                fill="black"
                stroke="black"
                points="591.56,-10.35 601.96,-8.32 592.57,-3.43 591.56,-10.35"
              />
            </g>
            <!-- billing -->
            <g id="node8" class="node">
              <title>billing</title>
              <polygon
                fill="#c2e9fb"
                stroke="black"
                points="566,-50.95 384,-50.95 384,-12.95 566,-12.95 566,-50.95"
              />
              <text
                text-anchor="middle"
                x="475"
                y="-35.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                billing
              </text>
              <text
                text-anchor="middle"
                x="475"
                y="-20.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                Stripe / LemonSqueezy
              </text>
            </g>
            <!-- core&#45;&gt;billing -->
            <g id="edge11" class="edge">
              <title>core&#45;&gt;billing</title>
              <path
                fill="none"
                stroke="black"
                d="M175.01,-35.83C233.89,-35.06 312.01,-34.05 373.62,-33.25"
              />
              <polygon
                fill="black"
                stroke="black"
                points="373.8,-36.75 383.75,-33.12 373.71,-29.75 373.8,-36.75"
              />
            </g>
            <!-- ui -->
            <g id="node2" class="node">
              <title>ui</title>
              <polygon
                fill="#f6d365"
                stroke="black"
                points="162.5,-126.95 12.5,-126.95 12.5,-88.95 162.5,-88.95 162.5,-126.95"
              />
              <text
                text-anchor="middle"
                x="87.5"
                y="-111.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                ui
              </text>
              <text
                text-anchor="middle"
                x="87.5"
                y="-96.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                Tailwind + Shadcn
              </text>
            </g>
            <!-- ui&#45;&gt;auth -->
            <g id="edge2" class="edge">
              <title>ui&#45;&gt;auth</title>
              <path
                fill="none"
                stroke="black"
                d="M162.5,-107.95C175.08,-107.95 188.18,-107.95 200.85,-107.95"
              />
              <polygon
                fill="black"
                stroke="black"
                points="200.9,-111.45 210.9,-107.95 200.9,-104.45 200.9,-111.45"
              />
            </g>
            <!-- auth&#45;&gt;events -->
            <g id="edge4" class="edge">
              <title>auth&#45;&gt;events</title>
              <path
                fill="none"
                stroke="black"
                d="M348.18,-100.95C365.76,-99.14 384.76,-97.17 402.53,-95.34"
              />
              <polygon
                fill="black"
                stroke="black"
                points="403.24,-98.78 412.83,-94.27 402.52,-91.82 403.24,-98.78"
              />
            </g>
            <!-- auth&#45;&gt;billing -->
            <g id="edge12" class="edge">
              <title>auth&#45;&gt;billing</title>
              <path
                fill="none"
                stroke="black"
                d="M318.32,-88.94C337.69,-79.58 361.82,-68.5 384,-59.95 389.06,-58 394.31,-56.09 399.63,-54.23"
              />
              <polygon
                fill="black"
                stroke="black"
                points="400.9,-57.5 409.24,-50.96 398.65,-50.87 400.9,-57.5"
              />
            </g>
            <!-- events&#45;&gt;matches -->
            <g id="edge5" class="edge">
              <title>events&#45;&gt;matches</title>
              <path
                fill="none"
                stroke="black"
                d="M537.11,-69.31C546.8,-66.25 556.69,-63.06 566,-59.95 580.59,-55.08 596.22,-49.63 610.89,-44.42"
              />
              <polygon
                fill="black"
                stroke="black"
                points="612.13,-47.69 620.38,-41.03 609.78,-41.1 612.13,-47.69"
              />
            </g>
            <!-- gamification -->
            <g id="node6" class="node">
              <title>gamification</title>
              <polygon
                fill="#a1c4fd"
                stroke="black"
                points="961,-78.95 781,-78.95 781,-40.95 961,-40.95 961,-78.95"
              />
              <text
                text-anchor="middle"
                x="871"
                y="-63.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                gamification
              </text>
              <text
                text-anchor="middle"
                x="871"
                y="-48.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                Ranking &amp; Campanhas
              </text>
            </g>
            <!-- events&#45;&gt;gamification -->
            <g id="edge8" class="edge">
              <title>events&#45;&gt;gamification</title>
              <path
                fill="none"
                stroke="black"
                d="M537.13,-83.6C599.47,-79.17 697.22,-72.23 770.69,-67.01"
              />
              <polygon
                fill="black"
                stroke="black"
                points="771.16,-70.48 780.89,-66.28 770.66,-63.5 771.16,-70.48"
              />
            </g>
            <!-- sharing -->
            <g id="node7" class="node">
              <title>sharing</title>
              <polygon
                fill="#c2e9fb"
                stroke="black"
                points="1149,-101.95 997,-101.95 997,-63.95 1149,-63.95 1149,-101.95"
              />
              <text
                text-anchor="middle"
                x="1073"
                y="-86.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                sharing
              </text>
              <text
                text-anchor="middle"
                x="1073"
                y="-71.75"
                font-family="Times,serif"
                font-size="14.00"
              >
                Feed &amp; Resultados
              </text>
            </g>
            <!-- events&#45;&gt;sharing -->
            <g id="edge10" class="edge">
              <title>events&#45;&gt;sharing</title>
              <path
                fill="none"
                stroke="black"
                d="M537.26,-88.83C629.27,-89.96 808.63,-91.38 961,-87.95 969.32,-87.76 977.98,-87.5 986.64,-87.18"
              />
              <polygon
                fill="black"
                stroke="black"
                points="986.92,-90.67 996.78,-86.8 986.66,-83.68 986.92,-90.67"
              />
            </g>
            <!-- matches&#45;&gt;gamification -->
            <g id="edge7" class="edge">
              <title>matches&#45;&gt;gamification</title>
              <path
                fill="none"
                stroke="black"
                d="M745.08,-35.67C753.5,-37.3 762.22,-39 770.95,-40.7"
              />
              <polygon
                fill="black"
                stroke="black"
                points="770.31,-44.14 780.8,-42.61 771.65,-37.27 770.31,-44.14"
              />
            </g>
            <!-- gamification&#45;&gt;sharing -->
            <g id="edge9" class="edge">
              <title>gamification&#45;&gt;sharing</title>
              <path
                fill="none"
                stroke="black"
                d="M961.18,-70.2C969.62,-71.18 978.17,-72.16 986.57,-73.12"
              />
              <polygon
                fill="black"
                stroke="black"
                points="986.41,-76.63 996.74,-74.29 987.21,-69.67 986.41,-76.63"
              />
            </g>
          </g>
        </svg>

        <div class="tooltip" id="tooltip"></div>
      </div>
    </div>

    <script>
      (function () {
        const stage = document.getElementById("stage");
        const svg = stage.querySelector("svg");
        const tooltip = document.getElementById("tooltip");

        // Ensure viewBox
        const vb = svg.viewBox.baseVal;
        if (!vb || (vb.width === 0 && vb.height === 0)) {
          const bbox = svg.getBBox();
          svg.setAttribute(
            "viewBox",
            `${bbox.x} ${bbox.y} ${bbox.width} ${bbox.height}`
          );
        }

        // Pan & Zoom state
        let isPanning = false;
        let startPoint = { x: 0, y: 0 };
        let startViewBox = {
          x: svg.viewBox.baseVal.x,
          y: svg.viewBox.baseVal.y,
          w: svg.viewBox.baseVal.width,
          h: svg.viewBox.baseVal.height,
        };

        function setViewBox(x, y, w, h) {
          svg.setAttribute("viewBox", `${x} ${y} ${w} ${h}`);
        }

        function getViewBox() {
          const vb = svg.viewBox.baseVal;
          return { x: vb.x, y: vb.y, w: vb.width, h: vb.height };
        }

        // Mouse wheel zoom
        stage.addEventListener(
          "wheel",
          function (e) {
            e.preventDefault();
            const delta = Math.sign(e.deltaY);
            const factor = delta > 0 ? 1.1 : 0.9;
            const vb = getViewBox();

            // Mouse position in SVG coordinates
            const pt = svg.createSVGPoint();
            pt.x = e.clientX - svg.getBoundingClientRect().left;
            pt.y = e.clientY - svg.getBoundingClientRect().top;
            const svgPt = pt.matrixTransform(svg.getScreenCTM().inverse());

            const newW = vb.w * factor;
            const newH = vb.h * factor;
            const kx = (svgPt.x - vb.x) / vb.w;
            const ky = (svgPt.y - vb.y) / vb.h;
            const newX = svgPt.x - newW * kx;
            const newY = svgPt.y - newH * ky;
            setViewBox(newX, newY, newW, newH);
          },
          { passive: false }
        );

        // Drag to pan
        stage.addEventListener("mousedown", function (e) {
          if (e.target.closest("button")) return;
          isPanning = true;
          startPoint = { x: e.clientX, y: e.clientY };
          const vb = getViewBox();
          startViewBox = { x: vb.x, y: vb.y, w: vb.w, h: vb.h };
        });
        window.addEventListener("mousemove", function (e) {
          if (!isPanning) return;
          const dx = e.clientX - startPoint.x;
          const dy = e.clientY - startPoint.y;
          const scaleX = startViewBox.w / svg.clientWidth;
          const scaleY = startViewBox.h / svg.clientHeight;
          setViewBox(
            startViewBox.x - dx * scaleX,
            startViewBox.y - dy * scaleY,
            startViewBox.w,
            startViewBox.h
          );
        });
        window.addEventListener("mouseup", function () {
          isPanning = false;
        });

        // Buttons
        document.getElementById("reset").addEventListener("click", function () {
          const bbox = svg.getBBox();
          setViewBox(bbox.x, bbox.y, bbox.width, bbox.height);
        });
        document
          .getElementById("zoomIn")
          .addEventListener("click", function () {
            const vb = getViewBox();
            setViewBox(
              vb.x + vb.w * 0.05,
              vb.y + vb.h * 0.05,
              vb.w * 0.9,
              vb.h * 0.9
            );
          });
        document
          .getElementById("zoomOut")
          .addEventListener("click", function () {
            const vb = getViewBox();
            setViewBox(
              vb.x - vb.w * 0.055,
              vb.y - vb.h * 0.055,
              vb.w * 1.1,
              vb.h * 1.1
            );
          });

        // Tooltips from <title> inside Graphviz nodes/edges
        function findTitleText(el) {
          const t = el.querySelector("title");
          return t ? t.textContent : null;
        }

        stage.addEventListener("mousemove", function (e) {
          const el = e.target.closest("g, polygon, path, text, rect");
          let title = null;
          if (el) {
            // climb up to group that may contain title
            let cur = el;
            while (cur && cur !== stage) {
              title = findTitleText(cur);
              if (title) break;
              cur = cur.parentNode;
            }
          }
          if (title) {
            tooltip.textContent = title;
            tooltip.style.left = e.clientX + "px";
            tooltip.style.top = e.clientY + "px";
            tooltip.style.opacity = 1;
          } else {
            tooltip.style.opacity = 0;
          }
        });
      })();
    </script>
  </body>
</html>
